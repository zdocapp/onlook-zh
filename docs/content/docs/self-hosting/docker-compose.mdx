---
title: Docker Compose
description: 适用于小型团队和基础自托管的简单单容器部署方案
---

# Docker Compose

在虚拟机或本地机器上使用 Docker Compose 部署 Onlook。这是一个简单的单容器部署方案，专为小型团队和基础自托管需求设计。如需具备高可用性和可扩展性的企业级部署，请使用[云部署](/self-hosting/cloud-deployment)选项。

## 前置条件

**系统要求：**

- 4+ CPU 核心
- 8GB+ 内存（推荐 16GB）
- 50GB+ 可用磁盘空间
- Docker 20.10+ 和 Docker Compose 2.0+

**软件要求：**

- [Bun](https://bun.sh) - 包管理器和运行时
- [Node.js](https://nodejs.org/en/download) v20.16.0+（避免使用 v20.11.0）
- [Git](https://git-scm.com/downloads)
- [Docker](https://docs.docker.com/get-docker/) 和 [Docker Compose](https://docs.docker.com/compose/install/)

## 基础部署

> [!NOTE]
> 这是一个适用于小型团队和测试的简单部署方案。如需进行开发，请在仓库根目录使用 `bun dev` 命令。

### 1. 克隆仓库

```bash
git clone https://github.com/onlook-dev/onlook.git
cd onlook

# Install dependencies
bun install
```

### 2. 设置环境变量

对于 Docker Compose 部署，您需要创建一个环境文件。

```bash
# Run interactive environment setup
bun run setup:env
```

**必需变量：**

- **Supabase**：生产数据库 URL 和 API 密钥
- **OpenRouter API 密钥**：用于 AI 聊天功能
- **CodeSandbox 令牌**：用于开发容器

有关获取这些 API 密钥的详细说明，请参阅[开发设置指南](/developers/running-locally#3-get-api-keys)。

### 3. 启动后端服务

```bash
bun backend:start
```

这将在本地启动 Supabase，包括 PostgreSQL 数据库、身份验证和存储功能。这将启动一个独立的 Docker compose 服务。对于生产环境的 Supabase 连接，请在 `.env` 文件中更改 Supabase API 密钥。

### 4. 初始化数据库

```bash
# Push database schema
bun db:push
```

### 5. 使用 Docker Compose 部署

从仓库根目录部署生产容器：

```bash
docker-compose up -d
```

这将构建并启动：

- **Web 应用程序**：生产环境构建的 Next.js 应用（端口 3000）
- **健康检查**：自动容器健康监控
- **自动重启**：容器在故障时自动重启

**注意**：Docker 容器使用 `network_mode: "host"` 来访问主机上运行的本地 Supabase 服务。这使得容器能够连接到 `http://127.0.0.1:54321`（Supabase API）和 `127.0.0.1:54322`（PostgreSQL）。

### 6. 验证部署

- **主应用程序**：http://localhost:3000
- **Supabase 仪表板**：http://localhost:54323（来自 backend:start）

检查服务是否正在运行：

```bash
docker-compose ps
curl http://localhost:3000
```

## 故障排除

**常见问题：**

- **端口 3000 被占用**：停止其他服务或更改端口  
- **Docker 构建失败**：运行 `docker system prune` 后重试
- **数据库连接**：确认 `bun backend:start` 正在运行且 Supabase 可通过 http://127.0.0.1:54321 访问
- **容器无法连接至 Supabase**：确保在 docker-compose.yml 中设置 `network_mode: "host"` 以实现本地主机访问

## 限制与注意事项

**此部署方案旨在简化操作，而非实现高可靠性：**

**限制：**

- 单容器架构（存在单点故障）
- 无内置负载均衡或自动扩缩容功能  
- 需手动备份与灾难恢复
- 仅支持纵向扩展
- 不提供高可用性保证

**适用场景：**

- 小型团队（少于 10 用户）
- 开发/测试环境
- 概念验证部署
- 基础自托管需求

**不适用场景：**

- 关键业务生产环境
- 需要高可用性的大型团队
- 要求 99.9%+ 正常运行时间的环境

如需企业级部署，请选用具备冗余和扩缩容能力的[云部署方案](/self-hosting/cloud-deployment)。