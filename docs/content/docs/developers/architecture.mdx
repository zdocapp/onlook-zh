---
title: 架构
description: Onlook 架构概览
---

# Onlook 架构

Onlook 采用单体仓库结构，包含多个相互关联的应用和包，主要使用 Next.js、Supabase、TailwindCSS 和 Drizzle 构建。

<div className="relative h-[500px] overflow-hidden">
  <iframe
    className="absolute top-0 left-0 h-full w-full"
    src="https://www.youtube.com/embed/iaixwRNjg4I"
    title="Onlook Architecture Walkthrough"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    allowFullScreen
  ></iframe>
</div>

![完整架构](/images/full-architecture.png)

## 目录结构

```
onlook/
|
├── apps/
│   ├── web/                       # Web application components
│   │   ├── client/                # Client-side application (Next.js)
│   │   ├── preload/               # Preload scripts (TypeScript)
│   │   ├── template/              # Template used for creating a new project (Next.js)
│   │   └── server/                # Server-side code (Fastify.js - unused for now)
│   │
│   └── backend/                   # Backend (Supabase)
│   
├── packages/
│   ├── models/                    # Shared data models and types
│   ├── ui/                        # Reusable UI components and theming (ShadCN + TailwindCSS)
│   ├── ai/                        # AI integration utilities (AI SDK)
│   └── schema/                    # Shared schema for the application (Drizzle ORM)
│   
└── docs/                          # Documentation (Fumadocs + Nextjs)
```

## 高层概览

### 可视化编辑

从技术上讲，Onlook 是一个指向运行应用的本地主机的浏览器。它可以像 Chrome 开发者工具一样操作 DOM，所有更改都通过 CSS 样式表或 DOM 操作注入到页面中。这些更改在写入代码之前是非持久性的。

### 写入代码

为了将更改转换为代码，我们在构建时向 DOM 元素注入一个属性，该属性像源映射一样指向代码。该属性提供了代码块的位置和组件范围。然后我们找到代码，将其解析为 AST，注入样式，再写回代码。

### 框架支持

这种技术是框架无关的，因为我们可以为其他框架换用不同的编译器。它可以适用于任何代码库，因为我们只使用不需要任何自定义代码的开放标准。生成的代码直接写入您的本地代码库，因此您始终可以获取输出而不会被工具锁定。

### 操作

所有更改都以操作(action)的形式存储。这种方式使得它们可以被序列化、存储和重现。我们这样设计是为了最终能够实现在线协作或让代理生成操作。要实现这一点，我们只需要提供本地运行的页面并处理传入的操作即可。

### 画布的工作原理

![画布架构](/images/canvas-architecture.png)

### 编辑的工作原理

DOM与代码写入之间的编辑过程

操作演示视频：https://youtu.be/aGUD9xS1XvA

时间戳：

* [00:00](https://www.youtube.com/watch?v=aGUD9xS1XvA&t=0s) 介绍
* [00:15](https://www.youtube.com/watch?v=aGUD9xS1XvA&t=15s) 编辑元素
* [00:56](https://www.youtube.com/watch?v=aGUD9xS1XvA&t=56s) 编辑工作原理
* [02:10](https://www.youtube.com/watch?v=aGUD9xS1XvA&t=130s) 其他细节

![编辑循环](/images/edit-loop.png)

## 参考文献

旧的Electron架构文档（仍具参考价值，只需将webview替换为iframe）：https://github.com/onlook-dev/desktop/wiki/Architecture